#!/bin/bash

#RESULT=""; ADDRESSES=("127.0.0.1" "10.0.0.152"); nc -kulp 2222 | stdbuf -o0 sox -c 1 -t raw -e float -b 32 -r 16000 - -esigned-integer -b 16 -r 22050 -t raw - | stdbuf -o0 multimon-ng --timestamp -c -a STQC - | tee -a /home/jacek/nasluch/syrena.txt | tee >(cat 1>&2) | stdbuf -oL grep VALUES | stdbuf -oL cut -d \  -f 12 | stdbuf -oL grep -Fwf - /home/jacek/nasluch/osp.tsv | stdbuf -oL cut -d \" -f 2 | tee >(cat 1>&2) | tee -a /home/jacek/nasluch/syrena.txt | while read RESULT; do (echo Alarm dla $RESULT | stdbuf -oL python3 -u /home/jacek/projects/scripts/nasluch/bot_osp.py); for ADDR in ${ADDRESSES[@]}; do (echo Alarm dla $RESULT | stdbuf -oL nc -u $ADDR 9981 -w1); done; done

# ADDRESSES=("127.0.0.1" "10.0.0.152"); nc -kulp 2222 | sox -c 1 -t raw -e float -b 32 -r 16000 - -esigned-integer -b 16 -r 22050 -t raw - 2>/dev/null | multimon-ng --timestamp -c -a STQC - 2>/dev/null | stdbuf -oL tee >(cat 1>&2) | stdbuf -oL tee -a /home/jacek/nasluch/syreny.txt | stdbuf -oL cut -d ' ' -f 12 | stdbuf -oL python3 -u pattern.py | stdbuf -oL tee >(cat 1>&2) | stdbuf -oL tee -a /home/jacek/nasluch/syreny.txt | stdbuf -oL cut -f 2 | while read RESULT; do (echo Alarm dla $RESULT); for ADDR in ${ADDRESSES[@]}; do (echo $RESULT | nc "$ADDR" 9981 -w1); done; done

ADDRESSES=("127.0.0.1" "10.0.0.152"); nc -kulp 2222 | stdbuf -o0 sox -c 1 -t raw -e float -b 32 -r 16000 - -esigned-integer -b 16 -r 22050 -t raw - | stdbuf -o0 multimon-ng --timestamp -c -a STQC - | stdbuf -oL python3 -u /home/jacek/projects/scripts/nasluch/bot_osp.py | while read RESULT; do echo $RESULT; for ADDR in ${ADDRESSES[@]}; do (echo $RESULT | stdbuf -oL nc -u $ADDR 9981 -w1); done; done
